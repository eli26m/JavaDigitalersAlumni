-- ETAPA 1
-- 1.1.1
CREATE DATABASE LABORATORIO;
-- 1.1.2
USE LABORATORIO;

-- 1.1.3
CREATE TABLE FACTURAS (
	LETRA CHAR,
	NUMERO INT,
	CLIENTEID INT,
    ARTICULOID INT,
    FECHA DATE,
    MONTO DOUBLE,
    PRIMARY KEY (LETRA, NUMERO)
);

-- 1.1.4
CREATE TABLE ARTICULOS (
	ARTICULOSID INT PRIMARY KEY,
    NOMBRE VARCHAR(50),
    PRECIO DOUBLE,
    STOCK INT
);

-- 1.1.5
CREATE TABLE CLIENTES (
	CLIENTEID INT PRIMARY KEY,
	NOMBRE VARCHAR(25),
    APELLIDO VARCHAR(25),
    CUIT CHAR(16),
    DIRECCION VARCHAR(50),
    COMENTARIOS VARCHAR(50)
);

-- 1.1.6
SHOW DATABASES;
-- 1.1.7 / 1.1.8
# SHOW TABLES;
-- 1.1.9
DESC CLIENTES;

-- 1.2.1
ALTER TABLE FACTURAS
CHANGE CLIENTEID IDCLIENTE INT,
CHANGE ARTICULOID IDARTICULO INT,
MODIFY MONTO DOUBLE UNSIGNED;
DESC FACTURAS;

-- 1.2.2
ALTER TABLE ARTICULOS
CHANGE ARTICULOSID IDARTICULO INT,
MODIFY NOMBRE VARCHAR(75),
MODIFY PRECIO DOUBLE UNSIGNED NOT NULL,
MODIFY STOCK INT UNSIGNED NOT NULL;
DESC ARTICULOS;

-- 1.2.3
ALTER TABLE CLIENTES
CHANGE CLIENTEID IDCLIENTE INT,
MODIFY NOMBRE VARCHAR(30) NOT NULL,
MODIFY APELLIDO VARCHAR(35) NOT NULL,
CHANGE COMENTARIOS OBSERVACIONES VARCHAR(255);
DESC CLIENTES;

-- 1.3.1
INSERT INTO FACTURAS
VALUES	('A', 28, 14, 335, '2021-03-18', 1589.50),
		('A', 39, 26, 157, '2021-04-12', 979.75),
        ('B', 8, 17, 95, '2021-04-25', 513.35),
        ('B', 12, 5, 411, '2021-05-03', 2385.70),
        ('B', 19, 50, 157, '2021-05-26', 979.75);
SELECT * FROM FACTURAS;

-- 1.3.2
INSERT INTO ARTICULOS
VALUES	(95, 'Webcam con Micrófono Plug & play', 513.35, 39),
		(157, 'Apple AirPods Pro', 979.75, 152),
        (335, 'Lavasecarropas Automático Samsung', 1589.50, 12),
        (411, 'Gloria Trevi / Gloria / CD+DVD', 2385.70, 2);
SELECT * FROM ARTICULOS;

-- 1.3.3
INSERT INTO CLIENTES
VALUES	(5, 'Santiago', 'González', '23-24582359-9', 'Uriburu 558 - 7°A', 'VIP'),
		(14, 'Gloria', 'Fernández', '23-35965852-5', 'Constitución 323', 'GBA'),
        (17, 'Gonzalo', 'López', '23-33587416-0', 'Arias 2624', 'GBA'),
        (26, 'Carlos', 'García', '23-42321230-9', 'Pasteur 322 - 2°C', 'VIP'),
        (50, 'Micaela', 'Altieri', '23-22885566-5', 'Santamarina 1255', 'GBA');
SELECT * FROM CLIENTES;

-- ETAPA 2
-- 2.1.1
-- Se importó la tabla CLIENTES_NEPTUNO.

-- 2.1.2
ALTER TABLE CLIENTES_NEPTUNO
MODIFY IDCliente VARCHAR(5) PRIMARY KEY,
MODIFY NombreCompania VARCHAR(100) NOT NULL,
MODIFY Pais VARCHAR(15) NOT NULL
;
DESC CLIENTES_NEPTUNO;

-- 2.1.3
ALTER TABLE CLIENTES RENAME CONTACTOS;

-- 2.1.4
-- Se importó la tabla CLIENTES.

-- 2.1.5
ALTER TABLE CLIENTES
MODIFY COD_CLIENTE VARCHAR(7) PRIMARY KEY,
MODIFY EMPRESA VARCHAR(100) NOT NULL,
MODIFY CIUDAD VARCHAR(25) NOT NULL,
MODIFY TELEFONO INT UNSIGNED,
MODIFY RESPONSABLE VARCHAR(30)
;
DESC CLIENTES;

-- 2.1.6
-- Se importó la tabla PEDIDOS.

-- 2.1.7
ALTER TABLE PEDIDOS
MODIFY NUMERO_PEDIDO INT UNSIGNED PRIMARY KEY,
MODIFY CODIGO_CLIENTE VARCHAR(7) NOT NULL,
MODIFY FECHA_PEDIDO DATE NOT NULL,
MODIFY FORMA_PAGO ENUM('APLAZADO','CONTADO','TARJETA'),
MODIFY ENVIADO ENUM('SI','NO')
;
DESC PEDIDOS;

-- 2.1.8
-- Se importó la tabla PRODUCTOS.

-- 2.1.9
ALTER TABLE PRODUCTOS
MODIFY COD_PRODUCTO INT UNSIGNED PRIMARY KEY,
MODIFY SECCION VARCHAR(20) NOT NULL,
MODIFY NOMBRE VARCHAR(40) NOT NULL,
MODIFY IMPORTADO ENUM('VERDADERO','FALSO') NOT NULL,
MODIFY ORIGEN VARCHAR(25) NOT NULL,
MODIFY DIA INT UNSIGNED NOT NULL,
MODIFY MES INT UNSIGNED NOT NULL,
MODIFY ANO INT UNSIGNED NOT NULL
;
DESC PRODUCTOS;

-- 2.2.1 / 2.2.2 / 2.2.3
-- Se ejecutó el script NACIMIENTOS.

-- 2.2.4 / 2.2.5 / 2.2.8
-- Se ejecutó el script PEDIDOS_NEPTUNO.

-- 2.2.6 / 2.2.7 / 2.2.9
-- Se ejecutó el script TABLAS_EXTERNAS.

-- 2.3.1
DESC CLIENTES_NEPTUNO;
-- 2.3.2
SELECT NOMBRECOMPANIA, CIUDAD, PAIS FROM CLIENTES_NEPTUNO;
-- 2.3.3
SELECT NOMBRECOMPANIA, CIUDAD, PAIS FROM CLIENTES_NEPTUNO ORDER BY PAIS;
-- 2.3.4
SELECT NOMBRECOMPANIA, CIUDAD, PAIS FROM CLIENTES_NEPTUNO ORDER BY PAIS, CIUDAD;
-- 2.3.5
SELECT NOMBRECOMPANIA, CIUDAD, PAIS FROM CLIENTES_NEPTUNO ORDER BY PAIS LIMIT 10;
-- 2.3.6
SELECT NOMBRECOMPANIA, CIUDAD, PAIS FROM CLIENTES_NEPTUNO ORDER BY PAIS LIMIT 5 OFFSET 10;

DESC NACIMIENTOS;
-- 2.4.1
SELECT * FROM NACIMIENTOS WHERE NACIONALIDAD = 'EXTRANJERA';
-- 2.4.2
SELECT * FROM NACIMIENTOS WHERE EDAD_MADRE < 18 ORDER BY EDAD_MADRE;
-- 2.4.3
SELECT * FROM NACIMIENTOS WHERE EDAD_MADRE = EDAD_PADRE;
-- 2.4.4
SELECT * FROM NACIMIENTOS WHERE EDAD_PADRE - EDAD_MADRE > 40;

DESC CLIENTES_NEPTUNO;
-- 2.4.5
SELECT * FROM CLIENTES_NEPTUNO WHERE PAIS = 'Argentina';
-- 2.4.6
SELECT * FROM CLIENTES_NEPTUNO WHERE CIUDAD <> 'Argentina' ORDER BY PAIS;

DESC NACIMIENTOS;
-- 2.4.7
SELECT * FROM NACIMIENTOS WHERE SEMANAS < 20 ORDER BY SEMANAS DESC;
-- 2.4.8
SELECT * FROM NACIMIENTOS WHERE SEXO = 'FEMENINO' AND NACIONALIDAD = 'EXTRANJERA' AND ESTADO_CIVIL_MADRE = 'SOLTERA' AND EDAD_MADRE > 40;

DESC CLIENTES_NEPTUNO;
-- 2.4.9
SELECT * FROM CLIENTES_NEPTUNO WHERE PAIS = 'ARGENTINA' OR PAIS = 'BRASIL' OR PAIS = 'VENEZUELA' ORDER BY PAIS, CIUDAD;

DESC NACIMIENTOS;
-- 2.4.10
SELECT * FROM NACIMIENTOS WHERE SEMANAS BETWEEN 20 AND 25 ORDER BY SEMANAS;
-- 2.4.11
SELECT * FROM NACIMIENTOS WHERE COMUNA IN (1101, 3201, 5605, 8108, 9204, 13120, 15202) ORDER BY COMUNA;

DESC CLIENTES_NEPTUNO;
-- 2.4.12
SELECT * FROM CLIENTES_NEPTUNO WHERE IDCLIENTE LIKE 'C%';
-- 2.4.13
SELECT * FROM CLIENTES_NEPTUNO WHERE CIUDAD LIKE 'B____';

DESC NACIMIENTOS;
-- 2.4.14
SELECT * FROM NACIMIENTOS WHERE HIJOS_TOTAL > 10;

-- ETAPA 3
-- 3.1 Se hizo un backup de la base de datos.

-- 3.2.1
SELECT IDCLIENTE, NOMBRECOMPANIA, CONCAT(DIRECCION, ' - ', CIUDAD, ' - ', PAIS) AS UBICACION FROM CLIENTES_NEPTUNO;
-- 3.2.2
SELECT IDCLIENTE, NOMBRECOMPANIA, CONCAT_WS(' - ', DIRECCION, CIUDAD, PAIS) AS UBICACION FROM CLIENTES_NEPTUNO;
-- 3.2.3
SELECT IDCLIENTE, UPPER(NOMBRECOMPANIA) AS EMPRESA, CONCAT_WS(' - ', DIRECCION, CIUDAD, PAIS) AS UBICACION FROM CLIENTES_NEPTUNO;
-- 3.2.4
SELECT LOWER(IDCLIENTE) AS CODIGO, UPPER(NOMBRECOMPANIA) AS EMPRESA, CONCAT_WS(' - ', DIRECCION, CIUDAD, PAIS) AS UBICACION FROM CLIENTES_NEPTUNO;

-- 3.2.5
SELECT FECHA, LEFT(SEXO, 1) AS SEXO, LEFT(TIPO_PARTO, 1) AS TIPO FROM NACIMIENTOS;

-- 3.2.6
SELECT *, UPPER(CONCAT(LEFT(CIUDAD, 1), LEFT(PAIS, 1), RIGHT(PAIS, 2))) AS CODIGO FROM CLIENTES_NEPTUNO;

-- 3.2.7
SELECT SEXO, FECHA, TIPO_PARTO, ATENC_PART, LOCAL_PART, SUBSTRING(FECHA, 4, 2) AS MES FROM NACIMIENTOS ORDER BY MES;
-- 3.2.8
SELECT SEXO, FECHA, TIPO_PARTO, REPLACE(NACIONALIDAD, 'Chilena', 'Ciudadana') AS NACIONALIDAD FROM NACIMIENTOS;

-- 3.3.1
SELECT * FROM PEDIDOS_NEPTUNO WHERE YEAR(FECHAPEDIDO) = 1998;
-- 3.3.2
SELECT * FROM PEDIDOS_NEPTUNO WHERE MONTH(FECHAPEDIDO) BETWEEN 08 AND 09 AND YEAR(FECHAPEDIDO) = 1997;
-- 3.3.3
SELECT * FROM PEDIDOS_NEPTUNO WHERE DAY(FECHAPEDIDO) = 01;
-- 3.3.4
SELECT *, DATEDIFF(CURDATE(), FECHAPEDIDO) AS 'DIAS TRANSCURRIDOS' FROM PEDIDOS_NEPTUNO;
-- 3.3.5
SELECT *, DATEDIFF(CURDATE(), FECHAPEDIDO) AS 'DIAS TRANSCURRIDOS', DAYNAME(FECHAPEDIDO) AS DIA FROM PEDIDOS_NEPTUNO;
-- 3.3.6
SELECT *, DATEDIFF(CURDATE(), FECHAPEDIDO) AS 'DIAS TRANSCURRIDOS', DAYNAME(FECHAPEDIDO) AS DIA, DAYOFYEAR(FECHAPEDIDO) AS 'DIA DEL AÑO' FROM PEDIDOS_NEPTUNO;
-- 3.3.7
SELECT *, DATEDIFF(CURDATE(), FECHAPEDIDO) AS 'DIAS TRANSCURRIDOS', DAYNAME(FECHAPEDIDO) AS DIA, DAYOFYEAR(FECHAPEDIDO) AS 'DIA DEL AÑO', MONTHNAME(FECHAPEDIDO) AS MES FROM PEDIDOS_NEPTUNO;
-- 3.3.8
SELECT *, DATEDIFF(CURDATE(), FECHAPEDIDO) AS 'DIAS TRANSCURRIDOS', DAYNAME(FECHAPEDIDO) AS DIA, DAYOFYEAR(FECHAPEDIDO) AS 'DIA DEL AÑO', MONTHNAME(FECHAPEDIDO) AS MES, ADDDATE(FECHAPEDIDO, INTERVAL 30 DAY) AS 'PRIMER VENCIMIENTO' FROM PEDIDOS_NEPTUNO;
-- 3.3.9
SELECT *, DATEDIFF(CURDATE(), FECHAPEDIDO) AS 'DIAS TRANSCURRIDOS', DAYNAME(FECHAPEDIDO) AS DIA, DAYOFYEAR(FECHAPEDIDO) AS 'DIA DEL AÑO', MONTHNAME(FECHAPEDIDO) AS MES, ADDDATE(FECHAPEDIDO, INTERVAL 30 DAY) AS 'PRIMER VENCIMIENTO', ADDDATE(FECHAPEDIDO, INTERVAL 2 MONTH) AS 'SEGUNDO VENCIMIENTO' FROM PEDIDOS_NEPTUNO;

-- 3.4.1
SELECT *, ROUND((CARGO * 0.21), 2) AS IVA FROM PEDIDOS_NEPTUNO;
-- 3.4.2
SELECT *, ROUND((CARGO * 0.21), 2) AS IVA, ROUND(CARGO * 1.21, 2) AS NETO FROM PEDIDOS_NEPTUNO;
-- 3.4.3
SELECT *, ROUND((CARGO * 0.21), 2) AS IVA, ROUND(CARGO * 1.21, 2) AS NETO, FLOOR(ROUND(CARGO * 1.21, 2)) AS 'REDONDEO A FAVOR CLIENTE' FROM PEDIDOS_NEPTUNO;
-- 3.4.4
SELECT *, ROUND((CARGO * 0.21), 2) AS IVA, ROUND(CARGO * 1.21, 2) AS NETO, FLOOR(ROUND(CARGO * 1.21, 2)) AS 'REDONDEO A FAVOR CLIENTE', CEIL(ROUND(CARGO * 1.21, 2)) AS 'REDONDEO A FAVOR EMPRESA' FROM PEDIDOS_NEPTUNO;

-- 3.5.1
SELECT COUNT(*) FROM PEDIDOS_NEPTUNO;
-- 3.5.2
SELECT COUNT(*) AS 'ENTREGAS SPEEDY EXPRESS' FROM PEDIDOS_NEPTUNO WHERE TRANSPORTISTA = 'SPEEDY EXPRESS';
-- 3.5.3
SELECT COUNT(*) AS VENTAS FROM PEDIDOS_NEPTUNO WHERE EMPLEADO LIKE('C%');

-- 3.5.4
SELECT ROUND(AVG(PRECIOUNIDAD), 2) AS 'PRECIO PROMEDIO' FROM PRODUCTOS_NEPTUNO;
-- 3.5.5
SELECT ROUND(AVG(PRECIOUNIDAD), 2) AS 'PRECIO PROMEDIO', MIN(PRECIOUNIDAD) AS 'PRECIO INFERIOR' FROM PRODUCTOS_NEPTUNO;
-- 3.5.6
SELECT ROUND(AVG(PRECIOUNIDAD), 2) AS 'PRECIO PROMEDIO', MIN(PRECIOUNIDAD) AS 'PRECIO INFERIOR', MAX(PRECIOUNIDAD) AS 'PRECIO MAXIMO' FROM PRODUCTOS_NEPTUNO;
-- 3.5.7
SELECT MAX(PRECIOUNIDAD) AS 'PRECIO MAXIMO', NOMBRECATEGORIA AS CATEGORIA FROM PRODUCTOS_NEPTUNO GROUP BY CATEGORIA;

-- 3.5.8
SELECT TRANSPORTISTA, COUNT(*) AS ENTREGAS FROM PEDIDOS_NEPTUNO GROUP BY TRANSPORTISTA;

-- 3.5.9
SELECT SEXO, COUNT(*) AS NACIMIENTOS FROM NACIMIENTOS GROUP BY SEXO;

-- 3.5.10
SELECT ROUND(SUM(CARGO), 2) AS 'TOTAL GASTOS', NOMBRECOMPANIA AS CLIENTE FROM PEDIDOS_NEPTUNO GROUP BY CLIENTE;

-- 3.5.11
SELECT SECCION, COUNT(*) AS CANTIDAD FROM PRODUCTOS GROUP BY SECCION ORDER BY CANTIDAD DESC;

-- 3.5.12
SELECT YEAR(FECHAPEDIDO) AS ANIO, MONTH(FECHAPEDIDO) AS MES, COUNT(*) AS VENTAS FROM PEDIDOS_NEPTUNO GROUP BY ANIO, MES ORDER BY ANIO, MES;

-- 3.5.13
SELECT EMPLEADO, ROUND(SUM(CARGO), 2) AS FACTURACION, ROUND(AVG(CARGO), 2) AS PROMEDIO, MAX(CARGO) AS 'MEJOR VENTA', MIN(CARGO) AS 'PEOR VENTA', COUNT(*) AS VENTAS FROM PEDIDOS_NEPTUNO GROUP BY EMPLEADO;
